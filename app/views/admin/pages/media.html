<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEWELLERY Admin - Media Library</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/variables.css">
    <link rel="stylesheet" href="../assets/css/main.css">
    
    <style>
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        .media-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s;
            cursor: pointer;
        }
        .media-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .media-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .media-info {
            padding: 0.75rem;
            background: white;
        }
        .media-upload-zone {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: border-color 0.3s;
        }
        .media-upload-zone:hover {
            border-color: #007bff;
        }
        .media-upload-zone.drag-over {
            border-color: #28a745;
            background-color: #f8f9fa;
        }
        .view-toggle {
            display: flex;
            gap: 0.25rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        .view-toggle button {
            border: none;
            background: white;
            padding: 0.375rem 0.75rem;
            cursor: pointer;
        }
        .view-toggle button.active {
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar Component Container -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header Component Container -->
            <div id="header-container"></div>

            <!-- Content -->
            <main class="content">
                <!-- Media Statistics Cards -->
                <div class="row mb-4">
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <img src="https://cdn-icons-png.flaticon.com/512/1375/1375106.png" alt="Total Images" width="32" height="32" class="me-2">
                                    <h3 class="mb-0 text-primary">1,247</h3>
                                </div>
                                <h6 class="fw-bold">Tổng Hình Ảnh</h6>
                                <p class="text-muted small mb-0">+48 tuần này</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <img src="https://cdn-icons-png.flaticon.com/512/2659/2659360.png" alt="Storage Used" width="32" height="32" class="me-2">
                                    <h3 class="mb-0 text-warning">2.4GB</h3>
                                </div>
                                <h6 class="fw-bold">Dung Lượng Sử Dụng</h6>
                                <p class="text-muted small mb-0">Còn lại 7.6GB</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <img src="https://cdn-icons-png.flaticon.com/512/3081/3081559.png" alt="Product Images" width="32" height="32" class="me-2">
                                    <h3 class="mb-0 text-success">847</h3>
                                </div>
                                <h6 class="fw-bold">Ảnh Sản Phẩm</h6>
                                <p class="text-muted small mb-0">68% tổng số</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card text-center h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center justify-content-center mb-2">
                                    <img src="https://cdn-icons-png.flaticon.com/512/1828/1828970.png" alt="Review Images" width="32" height="32" class="me-2">
                                    <h3 class="mb-0 text-info">324</h3>
                                </div>
                                <h6 class="fw-bold">Ảnh Đánh Giá</h6>
                                <p class="text-muted small mb-0">26% tổng số</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Media Management Tools -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Thư Viện Hình Ảnh</h5>
                    </div>
                    <div class="card-body">
                        <!-- Upload Area -->
                        <div class="media-upload-zone mb-4" id="uploadZone">
                            <img src="https://cdn-icons-png.flaticon.com/512/1375/1375106.png" alt="Upload" width="48" height="48" class="mb-3 opacity-50">
                            <h6>Kéo thả ảnh vào đây hoặc</h6>
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                Chọn Tệp
                            </button>
                            <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
                            <p class="text-muted small mt-2">Hỗ trợ: JPG, PNG, GIF (Tối đa 5MB mỗi ảnh)</p>
                        </div>

                        <!-- Tools and Filters -->
                        <div class="row align-items-center mb-3">
                            <div class="col-md-6">
                                <div class="d-flex gap-2 align-items-center">
                                    <!-- Search -->
                                    <div class="position-relative">
                                        <input type="text" class="form-control form-control-sm" placeholder="Tìm kiếm ảnh..." style="width: 200px; padding-left: 35px;" id="mediaSearch">
                                        <img src="https://cdn-icons-png.flaticon.com/512/751/751463.png" alt="Search" width="16" height="16" class="position-absolute" style="left: 10px; top: 50%; transform: translateY(-50%);">
                                    </div>
                                    
                                    <!-- Filter -->
                                    <select class="form-select form-select-sm" style="width: 150px;" id="typeFilter">
                                        <option value="all">Tất cả loại</option>
                                        <option value="product">Ảnh sản phẩm</option>
                                        <option value="review">Ảnh đánh giá</option>
                                        <option value="banner">Banner</option>
                                        <option value="other">Khác</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6 text-end">
                                <div class="d-flex gap-2 justify-content-end align-items-center">
                                    <!-- View Toggle -->
                                    <div class="view-toggle">
                                        <button class="active" onclick="toggleView('grid')">
                                            <img src="https://cdn-icons-png.flaticon.com/512/2311/2311524.png" alt="Grid" width="16" height="16">
                                        </button>
                                        <button onclick="toggleView('list')">
                                            <img src="https://cdn-icons-png.flaticon.com/512/1828/1828859.png" alt="List" width="16" height="16">
                                        </button>
                                    </div>
                                    
                                    <!-- More Actions -->
                                    <div class="dropdown">
                                        <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="dropdown">
                                            <img src="https://cdn-icons-png.flaticon.com/512/2311/2311524.png" alt="More" width="16" height="16">
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#" onclick="bulkDelete()">Xóa hàng loạt</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="bulkMove()">Di chuyển thư mục</a></li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li><a class="dropdown-item" href="#" onclick="cleanupUnused()">Dọn dẹp ảnh không dùng</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Media Grid View -->
                        <div class="media-grid" id="mediaGrid">
                            <!-- Sample Media Items -->
                            <div class="media-item" data-type="product" onclick="selectMedia(this)">
                                <img src="https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=200&h=150&fit=crop" alt="Ring">
                                <div class="media-info">
                                    <div class="fw-bold small">ring-diamond-001.jpg</div>
                                    <div class="text-muted small">245 KB • 800x600</div>
                                    <div class="text-success small">Sản phẩm</div>
                                </div>
                                <input type="checkbox" class="position-absolute top-0 start-0 m-2 media-checkbox">
                            </div>

                            <div class="media-item" data-type="product" onclick="selectMedia(this)">
                                <img src="https://images.unsplash.com/photo-1506630448388-4e683c67ddb0?w=200&h=150&fit=crop" alt="Necklace">
                                <div class="media-info">
                                    <div class="fw-bold small">necklace-gold-002.jpg</div>
                                    <div class="text-muted small">312 KB • 1024x768</div>
                                    <div class="text-success small">Sản phẩm</div>
                                </div>
                                <input type="checkbox" class="position-absolute top-0 start-0 m-2 media-checkbox">
                            </div>

                            <div class="media-item" data-type="product" onclick="selectMedia(this)">
                                <img src="https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=200&h=150&fit=crop" alt="Earrings">
                                <div class="media-info">
                                    <div class="fw-bold small">earrings-pearl-003.jpg</div>
                                    <div class="text-muted small">189 KB • 600x600</div>
                                    <div class="text-success small">Sản phẩm</div>
                                </div>
                                <input type="checkbox" class="position-absolute top-0 start-0 m-2 media-checkbox">
                            </div>

                            <div class="media-item" data-type="review" onclick="selectMedia(this)">
                                <img src="https://images.unsplash.com/photo-1573408301185-9146fe634ad0?w=200&h=150&fit=crop" alt="Review">
                                <div class="media-info">
                                    <div class="fw-bold small">review-customer-001.jpg</div>
                                    <div class="text-muted small">456 KB • 1200x900</div>
                                    <div class="text-info small">Đánh giá</div>
                                </div>
                                <input type="checkbox" class="position-absolute top-0 start-0 m-2 media-checkbox">
                            </div>

                            <div class="media-item" data-type="banner" onclick="selectMedia(this)">
                                <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=200&h=150&fit=crop" alt="Banner">
                                <div class="media-info">
                                    <div class="fw-bold small">banner-sale-2024.jpg</div>
                                    <div class="text-muted small">678 KB • 1920x1080</div>
                                    <div class="text-warning small">Banner</div>
                                </div>
                                <input type="checkbox" class="position-absolute top-0 start-0 m-2 media-checkbox">
                            </div>

                            <div class="media-item" data-type="product" onclick="selectMedia(this)">
                                <img src="https://images.unsplash.com/photo-1611652022419-a9419f74343d?w=200&h=150&fit=crop" alt="Bracelet">
                                <div class="media-info">
                                    <div class="fw-bold small">bracelet-silver-004.jpg</div>
                                    <div class="text-muted small">234 KB • 800x800</div>
                                    <div class="text-success small">Sản phẩm</div>
                                </div>
                                <input type="checkbox" class="position-absolute top-0 start-0 m-2 media-checkbox">
                            </div>
                        </div>

                        <!-- Media List View (Hidden by default) -->
                        <div class="table-responsive d-none" id="mediaList">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>
                                            <input type="checkbox" class="form-check-input" id="selectAllMedia">
                                        </th>
                                        <th>Tên Tệp</th>
                                        <th>Kích Thước</th>
                                        <th>Kích Thước File</th>
                                        <th>Loại</th>
                                        <th>Ngày Tải Lên</th>
                                        <th>Thao Tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><input type="checkbox" class="form-check-input media-list-checkbox"></td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <img src="https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=40&h=40&fit=crop" alt="Ring" width="40" height="40" class="rounded me-2">
                                                ring-diamond-001.jpg
                                            </div>
                                        </td>
                                        <td>800x600</td>
                                        <td>245 KB</td>
                                        <td><span class="badge bg-success">Sản phẩm</span></td>
                                        <td>22/10/2024</td>
                                        <td>
                                            <div class="dropdown">
                                                <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="dropdown">
                                                    <img src="https://cdn-icons-png.flaticon.com/512/2311/2311524.png" alt="Actions" width="16" height="16">
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="#" onclick="viewImage('ring-diamond-001.jpg')">Xem ảnh</a></li>
                                                    <li><a class="dropdown-item" href="#" onclick="copyUrl('ring-diamond-001.jpg')">Copy URL</a></li>
                                                    <li><a class="dropdown-item" href="#" onclick="downloadImage('ring-diamond-001.jpg')">Tải xuống</a></li>
                                                    <li><hr class="dropdown-divider"></li>
                                                    <li><a class="dropdown-item text-danger" href="#" onclick="deleteImage('ring-diamond-001.jpg')">Xóa</a></li>
                                                </ul>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Pagination -->
                <div id="pagination-container"></div>
            </main>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div class="modal fade" id="imagePreviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Xem Ảnh</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="previewImage" src="" alt="Preview" class="img-fluid">
                    <div class="mt-3">
                        <div id="imageInfo" class="text-muted"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" onclick="copyImageUrl()">Copy URL</button>
                    <button type="button" class="btn btn-success" onclick="downloadCurrentImage()">Tải xuống</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Component Manager -->
    <script src="../components/component-manager.js"></script>
    
    <!-- Page Configuration -->
    <script>
        window.pageConfig = {
            sidebar: {
                brandName: 'JEWELLERY',
                activePage: 'media',
                links: {
                    dashboard: '../index.html',
                    products: 'products.html',
                    orders: 'orders.html',
                    customers: 'customers.html',
                    'customer-roles': 'customer-roles.html',
                    collections: 'collections.html',
                    reviews: 'reviews.html',
                    media: 'media.html',
                    discounts: 'discounts.html',
                    payments: 'payments.html'
                },
                categories: [
                    { name: 'Vòng cổ', count: 12 },
                    { name: 'Vòng tay', count: 10 },
                    { name: 'Bông tai', count: 13 },
                    { name: 'Nhẫn', count: 4 },
                    { name: 'Lắc chân', count: 6 }
                ],
                categoriesTitle: 'DANH MỤC'
            },
            header: {
                title: 'Media Library',
                breadcrumb: 'Home > Product Management > Media Library'
            }
        };

        let selectedImages = [];

        // Media management functions
        function toggleView(view) {
            const gridView = document.getElementById('mediaGrid');
            const listView = document.getElementById('mediaList');
            const buttons = document.querySelectorAll('.view-toggle button');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (view === 'grid') {
                gridView.classList.remove('d-none');
                listView.classList.add('d-none');
                buttons[0].classList.add('active');
            } else {
                gridView.classList.add('d-none');
                listView.classList.remove('d-none');
                buttons[1].classList.add('active');
            }
        }

        function selectMedia(element) {
            const checkbox = element.querySelector('.media-checkbox');
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                element.style.border = '2px solid #007bff';
            } else {
                element.style.border = '1px solid #ddd';
            }
        }

        function viewImage(filename) {
            // Get image source from the filename
            const imageElement = document.querySelector(`[alt*="${filename.split('-')[0]}"]`);
            if (imageElement) {
                document.getElementById('previewImage').src = imageElement.src;
                document.getElementById('imageInfo').textContent = filename;
                new bootstrap.Modal(document.getElementById('imagePreviewModal')).show();
            }
        }

        function copyUrl(filename) {
            const url = `https://jewelry-admin.com/uploads/${filename}`;
            navigator.clipboard.writeText(url).then(() => {
                alert('URL đã được sao chép!');
            });
        }

        function copyImageUrl() {
            const url = document.getElementById('previewImage').src;
            navigator.clipboard.writeText(url).then(() => {
                alert('URL ảnh đã được sao chép!');
            });
        }

        function downloadImage(filename) {
            alert('Đang tải xuống: ' + filename);
        }

        function downloadCurrentImage() {
            const img = document.getElementById('previewImage');
            const link = document.createElement('a');
            link.href = img.src;
            link.download = 'image.jpg';
            link.click();
        }

        function deleteImage(filename) {
            if (confirm('Bạn có chắc chắn muốn xóa ảnh này?')) {
                alert('Ảnh đã được xóa: ' + filename);
                location.reload();
            }
        }

        function bulkDelete() {
            const checked = document.querySelectorAll('.media-checkbox:checked');
            if (checked.length === 0) {
                alert('Vui lòng chọn ít nhất một ảnh!');
                return;
            }
            if (confirm(`Bạn có chắc chắn muốn xóa ${checked.length} ảnh đã chọn?`)) {
                alert('Các ảnh đã được xóa!');
                location.reload();
            }
        }

        function bulkMove() {
            const checked = document.querySelectorAll('.media-checkbox:checked');
            if (checked.length === 0) {
                alert('Vui lòng chọn ít nhất một ảnh!');
                return;
            }
            const folder = prompt('Nhập tên thư mục mới:');
            if (folder && folder.trim() !== '') {
                alert(`${checked.length} ảnh đã được di chuyển vào thư mục: ${folder}`);
                location.reload();
            }
        }

        function cleanupUnused() {
            if (confirm('Bạn có chắc chắn muốn xóa tất cả ảnh không được sử dụng?')) {
                alert('Đã dọn dẹp 23 ảnh không sử dụng!');
                location.reload();
            }
        }

        // File upload handling
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('drag-over');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('drag-over');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('drag-over');
            const files = Array.from(e.dataTransfer.files);
            handleFileUpload(files);
        });

        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleFileUpload(files);
        });

        function handleFileUpload(files) {
            const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
            const maxSize = 5 * 1024 * 1024; // 5MB

            files.forEach(file => {
                if (!validTypes.includes(file.type)) {
                    alert(`Tệp ${file.name} không được hỗ trợ!`);
                    return;
                }
                
                if (file.size > maxSize) {
                    alert(`Tệp ${file.name} quá lớn (tối đa 5MB)!`);
                    return;
                }
                
                // Simulate upload
                console.log('Đang tải lên:', file.name);
            });
            
            if (files.length > 0) {
                alert(`Đã tải lên thành công ${files.length} ảnh!`);
                setTimeout(() => location.reload(), 1000);
            }
        }

        // Search functionality
        document.getElementById('mediaSearch').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const items = document.querySelectorAll('.media-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Filter functionality
        document.getElementById('typeFilter').addEventListener('change', function() {
            const filterValue = this.value;
            const items = document.querySelectorAll('.media-item');
            
            items.forEach(item => {
                const type = item.dataset.type;
                
                if (filterValue === 'all' || type === filterValue) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // Select all functionality
        document.getElementById('selectAllMedia')?.addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.media-list-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });

        // Initialize pagination
        document.addEventListener('DOMContentLoaded', function() {
            const paginationContainer = document.getElementById('pagination-container');
            if (paginationContainer) {
                window.ComponentManager.renderPagination(paginationContainer, {
                    ariaLabel: 'Media pagination'
                });
            }
        });
    </script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/main.js"></script>
</body>
</html>