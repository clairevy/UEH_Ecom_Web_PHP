<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEWELLERY Admin - Th√™m M√£ Gi·∫£m Gi√°</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/variables.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar Component Container -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header Component Container -->
            <div id="header-container"></div>

            <!-- Content -->
            <main class="content">
                <div class="row">
                    <!-- Discount Form -->
                    <div class="col-lg-8 col-md-12 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-4">
                                    <img src="https://cdn-icons-png.flaticon.com/512/1041/1041916.png" alt="Discount" width="32" height="32" class="me-3">
                                    <h4 class="fw-bold mb-0">T·∫°o M√£ Gi·∫£m Gi√° M·ªõi</h4>
                                </div>

                                <form id="discountForm">
                                    <!-- Basic Information -->
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <h6 class="fw-bold border-bottom pb-2">Th√¥ng Tin C∆° B·∫£n</h6>
                                        </div>
                                        
                                        <div class="col-md-6 mb-3">
                                            <label for="discountCode" class="form-label">M√£ Gi·∫£m Gi√° <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control text-uppercase" id="discountCode" placeholder="SUMMER2024" required>
                                            <small class="text-muted">Ch·ªâ s·ª≠ d·ª•ng ch·ªØ c√°i, s·ªë v√† d·∫•u g·∫°ch ngang</small>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="programName" class="form-label">T√™n Ch∆∞∆°ng Tr√¨nh <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="programName" placeholder="Gi·∫£m Gi√° M√πa H√® 2024" required>
                                        </div>

                                        <div class="col-12 mb-3">
                                            <label for="description" class="form-label">M√¥ T·∫£</label>
                                            <textarea class="form-control" id="description" rows="3" placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt v·ªÅ ch∆∞∆°ng tr√¨nh gi·∫£m gi√°..."></textarea>
                                        </div>
                                    </div>

                                    <!-- Discount Value -->
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <h6 class="fw-bold border-bottom pb-2">Gi√° Tr·ªã Gi·∫£m Gi√°</h6>
                                        </div>

                                        <div class="col-md-4 mb-3">
                                            <label for="discountType" class="form-label">Lo·∫°i Gi·∫£m Gi√° <span class="text-danger">*</span></label>
                                            <select class="form-select" id="discountType" required onchange="toggleDiscountFields()">
                                                <option value="">-- Ch·ªçn lo·∫°i --</option>
                                                <option value="percentage">Ph·∫ßn trƒÉm (%)</option>
                                                <option value="fixed">S·ªë ti·ªÅn c·ªë ƒë·ªãnh (VND)</option>
                                                <option value="free_shipping">Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn</option>
                                            </select>
                                        </div>

                                        <div class="col-md-4 mb-3" id="discountValueField">
                                            <label for="discountValue" class="form-label">Gi√° Tr·ªã <span class="text-danger">*</span></label>
                                            <input type="number" class="form-control" id="discountValue" placeholder="20" min="0">
                                        </div>

                                        <div class="col-md-4 mb-3" id="maxDiscountField" style="display: none;">
                                            <label for="maxDiscount" class="form-label">Gi·∫£m T·ªëi ƒêa (VND)</label>
                                            <input type="number" class="form-control" id="maxDiscount" placeholder="500000" min="0">
                                        </div>
                                    </div>

                                    <!-- Conditions -->
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <h6 class="fw-bold border-bottom pb-2">ƒêi·ªÅu Ki·ªán √Åp D·ª•ng</h6>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="minOrderValue" class="form-label">Gi√° Tr·ªã ƒê∆°n H√†ng T·ªëi Thi·ªÉu (VND)</label>
                                            <input type="number" class="form-control" id="minOrderValue" placeholder="1000000" min="0">
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="usageLimit" class="form-label">Gi·ªõi H·∫°n S·ªë L·∫ßn S·ª≠ D·ª•ng</label>
                                            <input type="number" class="form-control" id="usageLimit" placeholder="100" min="1">
                                            <small class="text-muted">ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng gi·ªõi h·∫°n</small>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="usageLimitPerUser" class="form-label">Gi·ªõi H·∫°n M·ªói Kh√°ch H√†ng</label>
                                            <input type="number" class="form-control" id="usageLimitPerUser" placeholder="1" min="1" value="1">
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="customerType" class="form-label">Lo·∫°i Kh√°ch H√†ng</label>
                                            <select class="form-select" id="customerType">
                                                <option value="all">T·∫•t c·∫£ kh√°ch h√†ng</option>
                                                <option value="new">Kh√°ch h√†ng m·ªõi</option>
                                                <option value="existing">Kh√°ch h√†ng c≈©</option>
                                                <option value="vip">Kh√°ch VIP</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Date Range -->
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <h6 class="fw-bold border-bottom pb-2">Th·ªùi Gian Hi·ªáu L·ª±c</h6>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="startDate" class="form-label">Ng√†y B·∫Øt ƒê·∫ßu <span class="text-danger">*</span></label>
                                            <input type="datetime-local" class="form-control" id="startDate" required>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="endDate" class="form-label">Ng√†y K·∫øt Th√∫c <span class="text-danger">*</span></label>
                                            <input type="datetime-local" class="form-control" id="endDate" required>
                                        </div>
                                    </div>

                                    <!-- Product/Category Restrictions -->
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <h6 class="fw-bold border-bottom pb-2">Gi·ªõi H·∫°n S·∫£n Ph·∫©m</h6>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="applicableProducts" class="form-label">√Åp D·ª•ng Cho</label>
                                            <select class="form-select" id="applicableProducts">
                                                <option value="all">T·∫•t c·∫£ s·∫£n ph·∫©m</option>
                                                <option value="specific">S·∫£n ph·∫©m c·ª• th·ªÉ</option>
                                                <option value="category">Theo danh m·ª•c</option>
                                                <option value="collection">Theo b·ªô s∆∞u t·∫≠p</option>
                                            </select>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="excludeProducts" class="form-label">Lo·∫°i Tr·ª´ S·∫£n Ph·∫©m</label>
                                            <select class="form-select" id="excludeProducts" multiple>
                                                <option value="sale">S·∫£n ph·∫©m ƒëang sale</option>
                                                <option value="new">S·∫£n ph·∫©m m·ªõi</option>
                                                <option value="limited">S·∫£n ph·∫©m gi·ªõi h·∫°n</option>
                                            </select>
                                            <small class="text-muted">Gi·ªØ Ctrl ƒë·ªÉ ch·ªçn nhi·ªÅu</small>
                                        </div>
                                    </div>

                                    <!-- Status & Options -->
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <h6 class="fw-bold border-bottom pb-2">T√πy Ch·ªçn Kh√°c</h6>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="status" class="form-label">Tr·∫°ng Th√°i <span class="text-danger">*</span></label>
                                            <select class="form-select" id="status" required>
                                                <option value="active">Ho·∫°t ƒë·ªông</option>
                                                <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
                                                <option value="scheduled">ƒê√£ l√™n l·ªãch</option>
                                            </select>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label for="priority" class="form-label">ƒê·ªô ∆Øu Ti√™n</label>
                                            <input type="number" class="form-control" id="priority" value="0" min="0" max="100">
                                            <small class="text-muted">S·ªë c√†ng cao c√†ng ∆∞u ti√™n</small>
                                        </div>

                                        <div class="col-12 mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="combinable">
                                                <label class="form-check-label" for="combinable">
                                                    C√≥ th·ªÉ k·∫øt h·ª£p v·ªõi c√°c m√£ kh√°c
                                                </label>
                                            </div>
                                        </div>

                                        <div class="col-12 mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="showOnWebsite" checked>
                                                <label class="form-check-label" for="showOnWebsite">
                                                    Hi·ªÉn th·ªã m√£ gi·∫£m gi√° tr√™n website
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="d-flex flex-wrap gap-2 mt-4">
                                        <button type="submit" class="btn btn-success-custom btn-custom px-4">
                                            <img src="https://cdn-icons-png.flaticon.com/512/5610/5610944.png" alt="Save" width="16" height="16" class="me-1">
                                            T·∫†O M√É GI·∫¢M GI√Å
                                        </button>
                                        <button type="button" class="btn btn-primary-custom btn-custom px-4" onclick="saveAsDraft()">
                                            <img src="https://cdn-icons-png.flaticon.com/512/3472/3472620.png" alt="Draft" width="16" height="16" class="me-1">
                                            L∆ØU NH√ÅP
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-custom px-4" onclick="cancelAdd()">
                                            <img src="https://cdn-icons-png.flaticon.com/512/189/189665.png" alt="Cancel" width="16" height="16" class="me-1">
                                            H·ª¶Y B·ªé
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Preview & Tips -->
                    <div class="col-lg-4 col-md-12 mb-4">
                        <!-- Preview Card -->
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="fw-bold mb-3">Xem Tr∆∞·ªõc M√£ Gi·∫£m Gi√°</h6>
                                
                                <div class="border rounded p-3 mb-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    <div class="text-white">
                                        <div class="text-center mb-2">
                                            <div style="font-family: 'Courier New', monospace; font-size: 24px; font-weight: bold; letter-spacing: 2px;" id="previewCode">
                                                SAMPLE2024
                                            </div>
                                        </div>
                                        <div class="text-center mb-2">
                                            <h5 class="mb-1" id="previewName">Ch∆∞∆°ng Tr√¨nh Gi·∫£m Gi√°</h5>
                                            <p class="mb-0 small" id="previewDescription">M√¥ t·∫£ ch∆∞∆°ng tr√¨nh</p>
                                        </div>
                                        <div class="text-center">
                                            <div class="badge bg-warning text-dark px-3 py-2" id="previewValue">
                                                Gi·∫£m 20%
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="small">
                                    <div class="mb-2">
                                        <strong>üìÖ Th·ªùi gian:</strong>
                                        <div class="text-muted" id="previewDuration">Ch∆∞a thi·∫øt l·∫≠p</div>
                                    </div>
                                    <div class="mb-2">
                                        <strong>üí∞ ƒê∆°n t·ªëi thi·ªÉu:</strong>
                                        <div class="text-muted" id="previewMinOrder">Kh√¥ng gi·ªõi h·∫°n</div>
                                    </div>
                                    <div class="mb-2">
                                        <strong>üë• S·ªë l·∫ßn s·ª≠ d·ª•ng:</strong>
                                        <div class="text-muted" id="previewUsageLimit">Kh√¥ng gi·ªõi h·∫°n</div>
                                    </div>
                                    <div>
                                        <strong>üìä Tr·∫°ng th√°i:</strong>
                                        <span class="badge bg-success" id="previewStatus">Ho·∫°t ƒë·ªông</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tips Card -->
                        <div class="card">
                            <div class="card-body">
                                <h6 class="fw-bold mb-3">üí° G·ª£i √ù T·∫°o M√£ Gi·∫£m Gi√°</h6>
                                <ul class="small text-muted mb-0 ps-3">
                                    <li class="mb-2">M√£ gi·∫£m gi√° n√™n ng·∫Øn g·ªçn v√† d·ªÖ nh·ªõ (6-12 k√Ω t·ª±)</li>
                                    <li class="mb-2">S·ª≠ d·ª•ng t·ª´ kh√≥a li√™n quan ƒë·∫øn d·ªãp (SUMMER, NEWYEAR, BLACK_FRIDAY...)</li>
                                    <li class="mb-2">ƒê·∫∑t gi√° tr·ªã ƒë∆°n h√†ng t·ªëi thi·ªÉu ƒë·ªÉ tr√°nh l·∫°m d·ª•ng</li>
                                    <li class="mb-2">Gi·ªõi h·∫°n s·ªë l·∫ßn s·ª≠ d·ª•ng cho m·ªói kh√°ch h√†ng</li>
                                    <li class="mb-2">Thi·∫øt l·∫≠p th·ªùi gian k·∫øt th√∫c r√µ r√†ng</li>
                                    <li class="mb-2">Ki·ªÉm tra kh√¥ng tr√πng v·ªõi m√£ ƒëang ho·∫°t ƒë·ªông</li>
                                    <li>Theo d√µi hi·ªáu qu·∫£ s·ª≠ d·ª•ng ƒë·ªÉ ƒëi·ªÅu ch·ªânh</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Component Manager -->
    <script src="../components/component-manager.js"></script>
    
    <!-- Page Configuration -->
    <script>
        window.pageConfig = {
            sidebar: {
                brandName: 'JEWELLERY',
                activePage: 'discounts'
            },
            header: {
                title: 'Add Discount',
                breadcrumb: 'Home > Discounts > Add New'
            }
        };

        // Form handling
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates
            const now = new Date();
            const startDate = new Date(now.getTime() + 24 * 60 * 60 * 1000); // Tomorrow
            const endDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000); // 30 days later
            
            document.getElementById('startDate').value = startDate.toISOString().slice(0, 16);
            document.getElementById('endDate').value = endDate.toISOString().slice(0, 16);

            // Real-time preview updates
            document.getElementById('discountCode').addEventListener('input', updatePreview);
            document.getElementById('programName').addEventListener('input', updatePreview);
            document.getElementById('description').addEventListener('input', updatePreview);
            document.getElementById('discountType').addEventListener('change', updatePreview);
            document.getElementById('discountValue').addEventListener('input', updatePreview);
            document.getElementById('maxDiscount').addEventListener('input', updatePreview);
            document.getElementById('minOrderValue').addEventListener('input', updatePreview);
            document.getElementById('usageLimit').addEventListener('input', updatePreview);
            document.getElementById('startDate').addEventListener('change', updatePreview);
            document.getElementById('endDate').addEventListener('change', updatePreview);
            document.getElementById('status').addEventListener('change', updatePreview);

            // Form submission
            document.getElementById('discountForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validate form
                if (!validateForm()) {
                    return;
                }

                // Collect form data
                const formData = collectFormData();
                
                console.log('Discount data:', formData);
                alert('ƒê√£ t·∫°o m√£ gi·∫£m gi√° th√†nh c√¥ng!');
                
                // Redirect to discounts list
                window.location.href = 'discounts.html';
            });
        });

        function toggleDiscountFields() {
            const discountType = document.getElementById('discountType').value;
            const valueField = document.getElementById('discountValueField');
            const maxField = document.getElementById('maxDiscountField');
            
            if (discountType === 'percentage') {
                valueField.style.display = 'block';
                maxField.style.display = 'block';
                document.getElementById('discountValue').placeholder = '20';
                document.getElementById('discountValue').max = '100';
            } else if (discountType === 'fixed') {
                valueField.style.display = 'block';
                maxField.style.display = 'none';
                document.getElementById('discountValue').placeholder = '100000';
                document.getElementById('discountValue').removeAttribute('max');
            } else if (discountType === 'free_shipping') {
                valueField.style.display = 'none';
                maxField.style.display = 'none';
            }
            
            updatePreview();
        }

        function updatePreview() {
            // Code
            const code = document.getElementById('discountCode').value || 'SAMPLE2024';
            document.getElementById('previewCode').textContent = code.toUpperCase();
            
            // Name
            const name = document.getElementById('programName').value || 'Ch∆∞∆°ng Tr√¨nh Gi·∫£m Gi√°';
            document.getElementById('previewName').textContent = name;
            
            // Description
            const desc = document.getElementById('description').value || 'M√¥ t·∫£ ch∆∞∆°ng tr√¨nh';
            document.getElementById('previewDescription').textContent = desc;
            
            // Value
            const type = document.getElementById('discountType').value;
            const value = document.getElementById('discountValue').value;
            let valueText = 'Ch∆∞a thi·∫øt l·∫≠p';
            
            if (type === 'percentage' && value) {
                const maxDiscount = document.getElementById('maxDiscount').value;
                valueText = `Gi·∫£m ${value}%`;
                if (maxDiscount) {
                    valueText += ` (T·ªëi ƒëa ${parseInt(maxDiscount).toLocaleString()} VND)`;
                }
            } else if (type === 'fixed' && value) {
                valueText = `Gi·∫£m ${parseInt(value).toLocaleString()} VND`;
            } else if (type === 'free_shipping') {
                valueText = 'Mi·ªÖn Ph√≠ V·∫≠n Chuy·ªÉn';
            }
            document.getElementById('previewValue').textContent = valueText;
            
            // Duration
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const duration = `${start.toLocaleDateString('vi-VN')} - ${end.toLocaleDateString('vi-VN')}`;
                document.getElementById('previewDuration').textContent = duration;
            }
            
            // Min Order
            const minOrder = document.getElementById('minOrderValue').value;
            document.getElementById('previewMinOrder').textContent = minOrder 
                ? `${parseInt(minOrder).toLocaleString()} VND` 
                : 'Kh√¥ng gi·ªõi h·∫°n';
            
            // Usage Limit
            const usageLimit = document.getElementById('usageLimit').value;
            document.getElementById('previewUsageLimit').textContent = usageLimit 
                ? `${usageLimit} l·∫ßn` 
                : 'Kh√¥ng gi·ªõi h·∫°n';
            
            // Status
            const status = document.getElementById('status').value;
            const statusBadge = document.getElementById('previewStatus');
            statusBadge.className = 'badge';
            
            if (status === 'active') {
                statusBadge.classList.add('bg-success');
                statusBadge.textContent = 'Ho·∫°t ƒë·ªông';
            } else if (status === 'inactive') {
                statusBadge.classList.add('bg-secondary');
                statusBadge.textContent = 'Kh√¥ng ho·∫°t ƒë·ªông';
            } else if (status === 'scheduled') {
                statusBadge.classList.add('bg-warning', 'text-dark');
                statusBadge.textContent = 'ƒê√£ l√™n l·ªãch';
            }
        }

        function validateForm() {
            const code = document.getElementById('discountCode').value;
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            
            // Check code format
            if (!/^[A-Z0-9_-]+$/.test(code)) {
                alert('M√£ gi·∫£m gi√° ch·ªâ ƒë∆∞·ª£c ch·ª©a ch·ªØ c√°i, s·ªë, d·∫•u g·∫°ch ngang v√† g·∫°ch d∆∞·ªõi!');
                return false;
            }
            
            // Check date range
            if (endDate <= startDate) {
                alert('Ng√†y k·∫øt th√∫c ph·∫£i sau ng√†y b·∫Øt ƒë·∫ßu!');
                return false;
            }
            
            return true;
        }

        function collectFormData() {
            return {
                code: document.getElementById('discountCode').value.toUpperCase(),
                programName: document.getElementById('programName').value,
                description: document.getElementById('description').value,
                type: document.getElementById('discountType').value,
                value: document.getElementById('discountValue').value,
                maxDiscount: document.getElementById('maxDiscount').value,
                minOrderValue: document.getElementById('minOrderValue').value,
                usageLimit: document.getElementById('usageLimit').value,
                usageLimitPerUser: document.getElementById('usageLimitPerUser').value,
                customerType: document.getElementById('customerType').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                applicableProducts: document.getElementById('applicableProducts').value,
                status: document.getElementById('status').value,
                priority: document.getElementById('priority').value,
                combinable: document.getElementById('combinable').checked,
                showOnWebsite: document.getElementById('showOnWebsite').checked
            };
        }

        function saveAsDraft() {
            const formData = collectFormData();
            formData.status = 'draft';
            
            console.log('Saving draft:', formData);
            alert('ƒê√£ l∆∞u nh√°p th√†nh c√¥ng!');
            window.location.href = 'discounts.html';
        }

        function cancelAdd() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy b·ªè? C√°c thay ƒë·ªïi s·∫Ω kh√¥ng ƒë∆∞·ª£c l∆∞u.')) {
                window.location.href = 'discounts.html';
            }
        }
    </script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
